<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</head>

<body>

<div id="container">
</div>

<script>
    var fieldWidth = 54;
    var fieldHeight = 30;
    var numAnts = 16;

    // Add a canvas, sized appropriately
    var canvtag = '<canvas id="antField" width="'+(fieldWidth*20)+'" height="'+(fieldHeight*20)+'" style="border:1px solid #000000;">';
    var canvas = $(canvtag);
    $('#container').append(canvas);
    var ctx = canvas.get(0).getContext("2d");

    // Create the ants and clear the scent field
    var ants = createRandomAnts(numAnts);
    var scentField = emptyScentField();

    setInterval( function() {
        scentField = scentStep(scentField);
        updateCanvas( scentColor(scentField) );

        for (var i = 0; i < numAnts; i++) 
            ants[i] = updateAnt(ants[i]);

    }, 100 );


    function createRandomAnt() {
        var antX = (Math.random() * fieldWidth) | 0;
        var antY = (Math.random() * fieldHeight) | 0;
        var direction = (Math.random() * 4) | 0;
       
        return [antX, antY, direction];
    }

    function createRandomAnts( numAnts ) {
        var ants = [];

        for (var i = 0; i < numAnts; i++)
            ants.push(createRandomAnt());

        return ants;
    }
    
    function updateAnt( antData ) {
        var antX = antData[0];
        var antY = antData[1];
        var direction = antData[2];

        var changeDir = Math.random() > 0.9;
        if (changeDir) 
            direction = Math.random() * 4 | 0;
 
        if (direction == 0)
            antX = Math.min( antX + 1, fieldWidth-1 );
        else if (direction == 1)
            antX = Math.max( antX - 1, 0 );
        else if (direction == 2)
            antY = Math.min( antY + 1, fieldHeight-1 );
        else if (direction == 3)
            antY = Math.max( antY - 1, 0 );

        return [antX, antY, direction];
    }


    function updateCanvas(field) {
        for (var y = 0; y < fieldHeight; y++)
            for (var x = 0; x < fieldWidth; x++)
                drawCell( x, y, field[y][x] );
    }

    function drawCell( x, y, color ) {
        ctx.fillStyle = color;
        ctx.fillRect(x*20,y*20,20,20);
    }

    function emptyScentField() {
        var field = new Array(fieldHeight);
        for (var y = 0; y < fieldHeight; y++) {
            field[y] = new Array(fieldWidth);

            for (var x = 0; x < fieldWidth; x++) 
                field[y][x] = 0;
        }

        return field;
    }



    function scentStep( inField ) {
        var field = new Array(fieldHeight);
        for (var y = 0; y < fieldHeight; y++) {
            field[y] = new Array(fieldWidth);

            for (var x = 0; x < fieldWidth; x++) 
                field[y][x] = Math.max(0, inField[y][x]-16);
       }
       for (var i = 0; i < numAnts; i++) {
            var antX = ants[i][0];
            var antY = ants[i][1];
            field[antY][antX] = Math.min(255, field[antY][antX]+128);
       }
 
       return field;
         
    }


    function scentColor(inField) {
        
        var field = new Array(fieldHeight);
        for (var y = 0; y < fieldHeight; y++) {
            field[y] = new Array(fieldWidth);

            for (var x = 0; x < fieldWidth; x++) {
                field[y][x] = "rgb("+inField[y][x]+","+0+","+0+")";
            }
        }

        return field;
    }


</script>

</body>
</html>

